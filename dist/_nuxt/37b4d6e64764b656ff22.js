(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{816:function(e,t,r){var content=r(834);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(53).default)("65ed9e7d",content,!0,{sourceMap:!1})},833:function(e,t,r){"use strict";var n=r(816);r.n(n).a},834:function(e,t,r){(e.exports=r(52)(!1)).push([e.i,"#login .columns{margin:3rem .25rem}#login .logo{margin:1rem auto;width:15rem}",""])},867:function(e,t,r){"use strict";r.r(t);r(67),r(45);var n=r(9),l=r(829),c=r(830),o=r.n(c),m=r(831);function d(){var data=Object(l.a)(["mutation ($username: String!,$password:String!) {\n            tokenAuth(username:$username,password:$password){\n              token\n            }\n          }"]);return d=function(){return data},data}function f(){var data=Object(l.a)(["query ($email: String!) {\n            user(email:$email){\n              id,\n              username,\n              firstName,\n              lastName,\n            }\n          }"]);return f=function(){return data},data}function h(){var data=Object(l.a)(["query{\n            randomUser{\n              email\n            }\n          }"]);return h=function(){return data},data}var v=o()(h()),_={asyncData:function(e){var t=e.app;e.route,e.store;return t.apolloProvider.defaultClient.query({query:v,variables:{}}).then(function(e){return e.data}).catch(function(e){return console.log(e)})},data:function(){return{isAuthenticated:!1,submitting:!1,error:null,credentials:{username:"",email:"",password:""},successfulData:null,successfulUsername:null}},layout:"plain",mounted:function(){this.isAuthenticated=!!this.$apolloHelpers.getToken()},methods:{getUsername:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.credentials.email=this.credentials.email.trim(),this.credentials.email.length){e.next=5;break}return this.successfulUsername=null,this.credentials.username="",e.abrupt("return");case 5:return this.$toast.show("Checking email..."),e.prev=6,e.next=9,this.$apollo.query({query:o()(f()),variables:{email:this.credentials.email}}).then(function(e){var data=e.data;t.successfulUsername=!0,t.credentials.username=data.user.username,t.credentials.id=data.user.id,t.credentials.firstName=data.user.firstName,t.credentials.lastName=data.user.lastName,t.$toast.success("Email confirmed")});case 9:e.sent,e.next=20;break;case 12:e.prev=12,e.t0=e.catch(6),this.successfulUsername=!1,this.credentials.username="",this.credentials.id=null,this.credentials.firstName=null,this.credentials.firstName=null,this.$toast.error("Email not registered");case 20:case"end":return e.stop()}},e,this,[[6,12]])}));return function(){return e.apply(this,arguments)}}(),login:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.submitting=!0,t=this.credentials,this.$toast.show("Logging you in..."),e.prev=3,e.next=6,this.$apollo.mutate({mutation:o()(d()),variables:t}).then(function(e){var data=e.data;r.$apolloHelpers.onLogin(data.tokenAuth.token,void 0,7),r.successfulData=data,r.isAuthenticated=!0,r.$store.commit("user/SET_USER",{username:r.credentials.username,email:r.credentials.email,firstName:r.credentials.firstName,lastName:r.credentials.lastName,kudoSet:r.credentials.kudoSet,recommendationSet:r.credentials.recommendationSet}),r.$toast.success("Login successful"),r.$router.replace("/organisation?login=true")});case 6:e.sent,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),"GraphQL error: Please, enter valid credentials"===e.t0.message?this.$toast.error("Please, enter valid credentials."):(console.log(m.error),this.$toast.error("An error occured, please try again.")),this.error=e.t0;case 13:case"end":return e.stop()}},e,this,[[3,9]])}));return function(){return e.apply(this,arguments)}}()}},C=(r(833),r(28)),component=Object(C.a)(_,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{attrs:{id:"login"}},[r("div",{staticClass:"columns is-centered"},[r("div",{staticClass:"column is-one-third has-text-centered"},[r("img",{staticClass:"logo",attrs:{src:"/images/logo.png",alt:"Logo",title:"Logo"}}),e._v(" "),r("section",{staticClass:"card has-text-left"},[e._m(0),e._v(" "),r("div",{staticClass:"card-content"},[r("form",{attrs:{method:"post"}},[e._m(1),e._v(" "),r("div",{staticClass:"field"},[r("p",{staticClass:"control has-icons-left has-icons-right"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.credentials.email,expression:"credentials.email"}],staticClass:"input",class:{"is-success":e.successfulUsername,"is-danger":!1===e.successfulUsername},attrs:{type:"email",placeholder:"Email"},domProps:{value:e.credentials.email},on:{blur:e.getUsername,input:function(t){t.target.composing||e.$set(e.credentials,"email",t.target.value)}}}),e._v(" "),e._m(2),e._v(" "),e.successfulUsername?r("span",{staticClass:"icon is-small is-right"},[r("i",{staticClass:"fas fa-check"})]):e._e(),e._v(" "),!1===e.successfulUsername?r("span",{staticClass:"icon is-small is-right"},[r("i",{staticClass:"fas fa-times"})]):e._e()]),e._v(" "),!1===e.successfulUsername?r("p",{staticClass:"help is-danger"},[e._v("This email is invalid")]):e._e(),e._v(" "),e.successfulUsername?r("p",{staticClass:"help is-success"},[e._v("This email is valid")]):e._e()]),e._v(" "),r("div",{staticClass:"field"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.credentials.username,expression:"credentials.username"}],attrs:{type:"hidden"},domProps:{value:e.credentials.username},on:{input:function(t){t.target.composing||e.$set(e.credentials,"username",t.target.value)}}})]),e._v(" "),e.successfulUsername?r("div",{staticClass:"field"},[r("p",{staticClass:"control has-icons-left"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.credentials.password,expression:"credentials.password"}],staticClass:"input",attrs:{type:"password",placeholder:"Password"},domProps:{value:e.credentials.password},on:{input:function(t){t.target.composing||e.$set(e.credentials,"password",t.target.value)}}}),e._v(" "),e._m(3)])]):e._e(),e._v(" "),e.randomUser?r("div",{staticClass:"field"},[r("p",{staticClass:"is-size-7 has-text-left"},[e._v("\n                Try the following credentials:\n                "),r("br"),e._v(" "),r("b",[e._v("Username:")]),e._v(" "+e._s(e.randomUser.email)+"\n                "),r("br"),e._v(" "),e.successfulUsername?r("span",[r("b",[e._v("Password:")]),e._v(" password")]):e._e()])]):e._e()])]),e._v(" "),r("footer",{staticClass:"card-footer"},[e.credentials.username?r("a",{staticClass:"card-footer-item",on:{click:e.login}},[e._v("Login")]):e._e(),e._v(" "),e.credentials.username?e._e():r("a",{staticClass:"card-footer-item has-text-black"},[e._v("Waiting for valid email")])])])])])])},[function(){var e=this.$createElement,t=this._self._c||e;return t("header",{staticClass:"card-header"},[t("h1",{staticClass:"card-header-title"},[this._v("\n            Login\n          ")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"field"},[t("p",{staticClass:"control has-icons-left"},[this._v("\n                Please enter your credentials to proceed\n              ")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon is-small is-left"},[t("i",{staticClass:"fas fa-envelope"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon is-small is-left"},[t("i",{staticClass:"fas fa-lock"})])}],!1,null,null,null);t.default=component.exports}}]);